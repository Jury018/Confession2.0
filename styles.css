
/* Cleaned stylesheet: single source of truth, no duplicates */
@font-face {
	font-family: 'AlanSans';
	src: url('assets/Alan_Sans/static/AlanSans-Regular.ttf') format('truetype');
	font-weight: 400;
	font-style: normal;
	font-display: swap;
}

:root{
	/* Clean stylesheet: deduplicated and compact */
	@font-face {
		font-family: 'AlanSans';
		src: url('assets/Alan_Sans/static/AlanSans-Regular.ttf') format('truetype');
		font-weight: 400;
		font-style: normal;
		font-display: swap;
	}

	:root {
		--bg-color: #0b0b0f;
		--dialogue-bg: rgba(0,0,0,0.72); /* slightly stronger for readability */
		--accent: #ffd166;
		--text: #ffffff; /* pure white for max contrast */
		--char-w: clamp(180px, 40vw, 680px);
		--base-font-size: clamp(0.875rem, 1.6vw + 0.6rem, 1.15rem);
	}

	* { box-sizing: border-box; }
	html,body { height:100%; margin:0; font-family: AlanSans, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; font-size: var(--base-font-size); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

	.game-container { position:relative; width:100%; height:100vh; overflow:hidden; background: radial-gradient(circle at 10% 20%, #1b1b2f 0%, var(--bg-color) 60%); display:flex; align-items:flex-end; justify-content:center; }
	.background { position:absolute; inset:0; z-index:0; background-image:url('assets/bg.gif'); background-size:cover; background-position:center; filter:brightness(0.9); }

	.character { position:relative; z-index:6; width:var(--char-w); height:auto; max-height:78vh; object-fit:contain; pointer-events:none; transition:opacity .6s ease, transform .35s ease; will-change:transform,opacity; animation: char-bob 6s ease-in-out infinite; }
	@keyframes char-bob { 0%{ transform:translateY(0) scale(1); } 50%{ transform:translateY(-6px) scale(1.005); } 100%{ transform:translateY(0) scale(1); } }
	@media (prefers-reduced-motion: reduce) { .character { animation: none !important; transition: none !important; } }

	.dialogue-box { position:relative; z-index:3; width:100%; max-width:1100px; margin:0 16px 28px; padding:20px; border-radius:14px; background:linear-gradient(180deg, rgba(0,0,0,0.6) 0%, var(--dialogue-bg) 100%); backdrop-filter: blur(8px); color:var(--text); display:flex; flex-direction:column; align-items:flex-start; gap:10px; transition:opacity .36s ease, transform .28s ease; box-shadow: 0 14px 40px rgba(0,0,0,0.7); }
	.dialogue-name { font-weight:800; color:var(--accent); font-size:1.02rem; letter-spacing:0.2px; text-shadow: 0 1px 0 rgba(0,0,0,0.4); }
	.dialogue-text { font-size:1.08rem; line-height:1.55; word-break:break-word; hyphens:auto; white-space:pre-wrap; text-shadow: 0 1px 0 rgba(0,0,0,0.35); }

	.next-btn { align-self:flex-end; background:var(--accent); border:none; color:#111; padding:10px 16px; border-radius:8px; font-weight:700; font-size:1rem; touch-action:manipulation; cursor:pointer; min-width:64px; }
	.next-btn:focus { outline:3px solid rgba(255,209,102,0.6); outline-offset:3px; }

	@media (hover:none) and (pointer:coarse) { .next-btn { padding:14px 18px; font-size:1.05rem; } .dialogue-text { font-size:1.22rem; line-height:1.6; } }

	@media (max-width:900px) { .character { position:absolute; left:4vw; bottom:8vh; transform:translateY(4%); z-index:12; } .dialogue-box { padding:14px; margin:0 10px 18px; z-index:4; } .dialogue-name { font-size:0.95rem; } }

	@media (max-width:600px) {
		:root { --char-w: clamp(120px, 36vw, 320px); }
		/* On small screens force the character visually behind the dialogue box */
		.character { width:var(--char-w); max-height:50vh; position:absolute; left:8px; bottom:8vh; transform:none; z-index:1; }
		.dialogue-box { max-width: calc(100% - var(--char-w) - 40px); margin-left:auto; margin-right:16px; padding:18px; z-index:20; }
		.dialogue-text, .dialogue-name { margin-right:0; }
		.next-btn { display:inline-flex; position:relative; right:auto; margin:8px 0 0 auto; }
	}

	.dialogue-box.mobile-character-in-dialogue { display:flex; align-items:flex-start; gap:12px; padding:12px; position:relative; z-index:20; }
	.dialogue-box.mobile-character-in-dialogue .character { position:fixed; left:0; bottom:0; width:clamp(80px,22vw,140px); align-self:flex-end; height:auto; max-height:60vh; object-fit:cover; object-position:bottom center; transform:translateY(6%); pointer-events:none; z-index:2; }
	.dialogue-box.mobile-character-in-dialogue .dialogue-text, .dialogue-box.mobile-character-in-dialogue .dialogue-name { margin:0; }
	.dialogue-box.mobile-character-in-dialogue .next-btn { align-self:flex-end; margin:0 4px 0 0; padding:8px 12px; font-size:0.95rem; border-radius:8px; }

	@media (max-width:380px) { .dialogue-box.mobile-character-in-dialogue .character { max-height:36vh; } .dialogue-box.mobile-character-in-dialogue .next-btn { padding:8px 10px; font-size:0.9rem; } .dialogue-text { font-size:1rem; } .next-btn { padding:12px 14px; } }

	@media (min-width:601px) and (max-width:900px) { .dialogue-box.mobile-character-in-dialogue { gap:10px; padding:14px; } .dialogue-box.mobile-character-in-dialogue .character { width:clamp(70px,18vw,100px); transform:none; max-height:30vh; align-self:center; z-index:1; } .dialogue-box.mobile-character-in-dialogue .dialogue-text, .dialogue-box.mobile-character-in-dialogue .dialogue-name { margin-left:8px; } }

	.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

	.dialogue-box { transform:translateY(6px); opacity:1; }
.next-btn{min-width:64px}

@media (hover: none) and (pointer: coarse) {
	.next-btn{padding:14px 18px;font-size:1.05rem}
	.dialogue-text{font-size:1.15rem}
}

@media (max-width:900px){
	.character{position:absolute;left:4vw;bottom:8vh;transform:translateY(4%);z-index:12}
	.dialogue-box{padding:14px;margin:0 10px 18px;z-index:4}
	.dialogue-name{font-size:0.95rem}
}
@media (max-width:600px){
    
	 :root{ --char-w: clamp(140px, 36vw, 360px); }
	 .character{width: var(--char-w);max-height:50vh;position:absolute;left:6px;bottom:10vh;transform:none;z-index:14}
    
    .dialogue-box{max-width: calc(100% - var(--char-w) - 32px);margin-left:auto;margin-right:16px;padding-right:18px;z-index:3}
	 .dialogue-text, .dialogue-name{margin-right: 0}
	 .next-btn{margin-right: calc(var(--char-w) - 6px)}
}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
@media (max-width:600px){
	:root{ --char-w: clamp(120px, 36vw, 320px); }

	.character{width: var(--char-w);max-height:50vh;position:absolute;left:8px;bottom:8vh;transform:none;z-index:14}
	.dialogue-box{max-width: calc(100% - var(--char-w) - 40px);margin-left:auto;margin-right:16px;padding:14px;z-index:3}
	.dialogue-text, .dialogue-name{margin-right: 0}
	
	.next-btn{display:inline-flex;position:relative;right:auto;margin:8px 0 0 auto}
}

@media (max-width:600px){
    .next-btn{display:none!important}
}

.dialogue-box.mobile-character-in-dialogue{
	display:flex;
	align-items:flex-start;
	gap:12px;
	padding:12px 12px 12px 12px;
}
.dialogue-box.mobile-character-in-dialogue .character{
	position: fixed;
	left:0; bottom:0; transform:none;
	width: clamp(80px, 22vw, 140px);
	align-self:flex-end;
	height: auto;
	max-height: 60vh;
	object-fit: cover;
	object-position: bottom center;
	transform: translateY(6%);
	pointer-events:none;
	z-index:2;
}
.dialogue-box.mobile-character-in-dialogue .dialogue-text,
.dialogue-box.mobile-character-in-dialogue .dialogue-name{
	margin:0;
}

.dialogue-box.mobile-character-in-dialogue .next-btn{
	align-self:flex-end;
	margin:0 4px 0 0;
	padding:8px 12px;
	font-size:0.95rem;
	border-radius:8px;
}

@media (max-width:380px){
	.dialogue-box.mobile-character-in-dialogue .character{max-height:36vh}
	.dialogue-box.mobile-character-in-dialogue .next-btn{padding:8px 10px;font-size:0.9rem}
	.dialogue-text{font-size:1.02rem; line-height:1.6}
	.next-btn{padding:12px 14px}
}

@media (min-width:601px) and (max-width:900px) {
	.dialogue-box.mobile-character-in-dialogue{
		gap:10px;
		padding:14px;
	}
	.dialogue-box.mobile-character-in-dialogue .character{
		width: clamp(70px, 18vw, 100px);
		transform:none;
		max-height:30vh;
		align-self:center;
		z-index:1;
	}
	.dialogue-box.mobile-character-in-dialogue .dialogue-text,
	.dialogue-box.mobile-character-in-dialogue .dialogue-name{
		margin-left:8px;
	}
}

.next-btn:focus{outline:3px solid rgba(255,209,102,0.6);outline-offset:3px}

.dialogue-box{transform:translateY(6px);opacity:1}
}

/* Final small-screen override: ensure character sits behind dialogue box */
@media (max-width:600px) {
	.character { z-index: 1 !important; }
	.dialogue-box, .dialogue-box.mobile-character-in-dialogue { z-index: 9999 !important; position: relative !important; }
	.dialogue-box.mobile-character-in-dialogue .character { z-index: 1 !important; }
}

/* Blossom/particle overlay for scene transitions */
.blossom-overlay {
	pointer-events: none;
	position: fixed;
	inset: 0;
	z-index: 9998; /* below the dialogue (9999) but above background */
	overflow: hidden;
}

/* Start overlay (play button) */
.start-overlay {
	position: fixed;
	inset: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	flex-direction: column;
	gap: 14px;
	background: linear-gradient(180deg, rgba(3,6,12,0.6), rgba(3,6,12,0.75));
	z-index: 10000;
	cursor: pointer;
}
.start-overlay:focus { outline: 3px solid rgba(255,209,102,0.8); }
.start-play { width: 84px; height: 84px; object-fit: contain; filter: drop-shadow(0 8px 18px rgba(0,0,0,0.5)); }
.start-label { color: var(--text); font-weight:700; font-size:1rem; opacity:0.95 }

/* hide overlay when game started */
.start-overlay.hidden { display: none !important; }

/* When start overlay is present, blur/dim the background for focus */
.start-overlay:not(.hidden) + .background {
	filter: blur(8px) brightness(0.55) saturate(0.9);
	transform-origin: center center;
	transform: scale(1.02);
	transition: filter 360ms ease, transform 520ms ease;
}

/* Visual novel entrance animations */
@keyframes vn-dialogue-in {
	0% { opacity: 0; transform: translateY(12px) scale(0.996); }
	100% { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes vn-character-in {
	0% { opacity: 0; transform: translateY(24px) scale(0.98); }
	60% { opacity: 1; transform: translateY(6px) scale(1.002); }
	100% { opacity: 1; transform: translateY(0) scale(1); }
}

.game-container.vn-started .dialogue-box {
	animation: vn-dialogue-in 520ms cubic-bezier(.2,.9,.2,1) both;
}
.game-container.vn-started .character {
	animation: vn-character-in 680ms cubic-bezier(.2,.9,.2,1) both;
}

@media (prefers-reduced-motion: reduce) {
	.game-container.vn-started .dialogue-box,
	.game-container.vn-started .character,
	.start-overlay:not(.hidden) + .background {
		animation: none !important;
		transition: none !important;
		transform: none !important;
		filter: none !important;
	}
}
.blossom {
	position: absolute;
	font-size: 20px;
	opacity: 0.95;
	transform: translateY(0) rotate(0deg);
	animation: float-up var(--float-duration, 4000ms) linear forwards, sway var(--sway-duration, 3000ms) ease-in-out infinite;
	will-change: transform, opacity;
	filter: drop-shadow(0 6px 6px rgba(0,0,0,0.25));
}

/* Image-based blossom variant */
.blossom.img {
	background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
	width: 40px;
	height: 40px;
	opacity: 0.98;
	pointer-events: none;
	mix-blend-mode: normal;
	will-change: transform, opacity;
}
.blossom.img.small { width: 22px; height:22px; }
.blossom.img.large { width: 56px; height:56px; }
@keyframes float-up {
	0% { transform: translateY(0) scale(0.95) rotate(0deg); opacity: 1; }
	100% { transform: translateY(-140vh) scale(1.02) rotate(90deg); opacity: 0; }
}
@keyframes sway {
	0% { transform: translateX(0) rotate(0deg); }
	25% { transform: translateX(10px) rotate(6deg); }
	50% { transform: translateX(-8px) rotate(-6deg); }
	75% { transform: translateX(6px) rotate(4deg); }
	100% { transform: translateX(-4px) rotate(-2deg); }
}

/* Inner petal element so we can compose float + sway separately */
.blossom.img .petal {
	width:100%; height:100%; background-size:contain; background-repeat:no-repeat; background-position:center; display:block;
	animation: float-up var(--float-duration, 4800ms) linear forwards;
	will-change: transform, opacity;
}
.blossom.img { animation: sway var(--sway-duration, 3000ms) ease-in-out infinite; }